{{ config(
    cluster_by = "_airbyte_emitted_at",
    partition_by = {"field": "_airbyte_emitted_at", "data_type": "timestamp", "granularity": "day"},
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_test_normalization",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to build a hash column based on the values of this record
-- depends_on: {{ ref('pull_request_stats_ab2') }}
select
    {{ dbt_utils.surrogate_key([
        'id',
        'url',
        'base',
        'body',
        'head',
        'user',
        boolean_to_string('draft'),
        'state',
        'title',
        '_links',
        array_to_string('labels'),
        boolean_to_string('locked'),
        boolean_to_string('merged'),
        'number',
        'commits',
        'node_id',
        'assignee',
        'comments',
        'diff_url',
        'html_url',
        'additions',
        array_to_string('assignees'),
        'closed_at',
        'deletions',
        'issue_url',
        boolean_to_string('mergeable'),
        'merged_at',
        'merged_by',
        'milestone',
        'patch_url',
        'auto_merge',
        'created_at',
        boolean_to_string('rebaseable'),
        'updated_at',
        'commits_url',
        'comments_url',
        'statuses_url',
        'changed_files',
        'mergeable_state',
        array_to_string('requested_teams'),
        'review_comments',
        'merge_commit_sha',
        'active_lock_reason',
        'author_association',
        'review_comment_url',
        array_to_string('requested_reviewers'),
        'review_comments_url',
        boolean_to_string('maintainer_can_modify'),
    ]) }} as _airbyte_pull_request_stats_hashid,
    tmp.*
from {{ ref('pull_request_stats_ab2') }} tmp
-- pull_request_stats
where 1 = 1

